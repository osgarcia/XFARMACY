<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <link href="/assets/img/favico.ico" rel="icon">

    <title>MED | Factura</title>
    <link rel="stylesheet" href="https://bootswatch.com/4/lux/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
   
  </head>

  <body class="bg-dark-200">
    <nav class="navbar navbar-expand-lg bg-dark" data-bs-theme="dark">
        <div class="container-fluid">
          <a class="navbar-brand" href="#"><h1><font color="white">MED</font></h1></a>

          <stripe-buy-button
          buy-button-id="buy_btn_1NplkHJNkXDc99lCnzu8DrTX"
          publishable-key="pk_test_51NoKp9JNkXDc99lC1m54WmExgIpseA3nK3ni0yrgQhX7lFvkJVhHL3phuKf5kKFnA3IV9USX7NUKtd3iHFmFJVba00T2SbAuVi"
        >
        </stripe-buy-button>

        </div>
    </nav>        
    <div class="container mt-5">
        <div class="row d-flex justify-content-center align-items-center h-100 ">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">       
    
                    <form action="/viewfact" method="get" >


                        <b><label class="formkit-label" for="input_0"><h5>Factura No. <%= data[0].Idcon %></h5></label></b>
                        
                        
                        <p>
                            <table id ="factura" class="table table-bordered table-hover text-center">
                               <thead>
                                   <tr class="table-dark">

                                    <th>
                                        Cantidad
                                    </th>
                                       <th>
                                           Descripcion
                                       </th>
                                       
                                       <th>
                                           Precio Unitario
                                       </th>
                                       <th>
                                           Total
                                       </th>
                                            
                               </thead>
                              
                   </p>

                   <tbody> 
                       <% if (data) { %>
                        <b><label class="formkit-label" for="input_0"><h6>Cliente: </h6><h7><%= data[0].Nocli %></h7></label></b>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <b><label class="formkit-label" for="input_0"><h6>Nit: </h6><h7><%= data[0].Clnit %></h7></label></b>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <b><label class="formkit-label" for="input_0"><h6>Fecha: </h6><h7><%= data[0].Fecconsul %></h7></label></b>   
                        <% for (var i = 0; i < data.length; i++) { %>
                           <tr>
                               <td><%= data[i].Cantprod %></td>
                               <td><%= data[i].Prod %></td>
                               <td><%= data[i].Preprod %></td>
                               <td><%= data[i].Total %></td>
                            

                           </tr>
                           

                           <% } %>
                           <% } %>
                               </tbody>
                              
                    </form>
                </div>
                </div>
            </div>
        </div>
    </div>
</table>

<script>
let total = 0;

let  totalCeldas = document.querySelectorAll('td + td + td + td');

for(let i = 0; i < totalCeldas.length; ++i){
    total += parseFloat(totalCeldas[i].firstChild.data);
}

let nuevaFila = document.createElement('tr');

let celda1 = document.createElement('td');
let textoCelda1 = document.createTextNode('Total:');
nuevaFila.appendChild(celda1);

let celda2 = document.createElement('td');
let textoCelda2 = document.createTextNode('Total:');
nuevaFila.appendChild(celda2)

let celdaTotal = document.createElement('td');
let textoCeldaTotal = document.createTextNode('Total:');
celdaTotal.appendChild(textoCeldaTotal);
nuevaFila.appendChild(celdaTotal);

let celdaValorTotal = document.createElement('td');
let textoCeldaValorTotal = document.createTextNode(total);
celdaValorTotal.appendChild(textoCeldaValorTotal);
nuevaFila.appendChild(celdaValorTotal);

document.getElementById('factura').appendChild(nuevaFila);

</script>


<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"></script>
<script src="https:////cdn.datatables.net/plug-ins/1.13.6/api/sum().js"></script>   

<script async
  src="https://js.stripe.com/v3/buy-button.js">
</script>


  </body>
</html>